use TWLife
go

declare @pno table
(
	PolicySerialNo varchar(50)
)

insert into @pno (PolicySerialNo) values
('A110214345'),
('A110214798'),
('A111007373'),
('A111004917'),
('A111010204'),
('A111010620'),
('A110195847'),
('A110219837'),
('A111000256'),
('A111005156'),
('A111009940'),
('A110191417'),
('A110216987'),
('A110217685'),
('A110200779'),
('A110203892'),
('A110219504'),
('A110220321'),
('A111002125'),
('A111003588'),
('A111003631'),
('A111009807'),
('A111010282'),
('A110220665'),
('A111001522'),
('A111003051'),
('A111003302'),
('A111005008'),
('A111008925'),
('A111010116'),
('A111010212'),
('A111010532'),
('A111010709'),
('A111010721'),
('A111010804'),
('A111010898'),
('A111010946'),
('A111010980'),
('A111011018'),
('A111011322'),
('A111011409'),
('A111011506'),
('A111011528'),
('A110209652'),
('A111009798'),
('A111009811'),
('A111010192'),
('A111010763'),
('A110212187'),
('A110213679'),
('A111010340'),
('A110214565'),
('A111001758'),
('A111007084'),
('A111008726'),
('A111010199'),
('A111010221'),
('A111010420'),
('A110208429'),
('A111007596'),
('A111007719'),
('A111008871'),
('A111008886'),
('A110210190'),
('A111004025'),
('A111004982'),
('A111005140'),
('A111008916'),
('A110210677'),
('A110216977'),
('A110219426'),
('A111002194'),
('A111002682'),
('A111003491'),
('A111005985'),
('A110183053'),
('A110199569'),
('A111001774'),
('A111001816'),
('A111005394'),
('A111006278'),
('A111010675'),
('A111000386'),
('A111003907'),
('A111006654'),
('A111010685'),
('A111011095'),
('A111011519'),
('A110218692'),
('A111008722'),
('A111008893'),
('A110197128'),
('A111001330'),
('A111008665'),
('A111008841'),
('A111008922'),
('A111009562'),
('A111010225'),
('A111010981'),
('B111000089'),
('A110187876'),
('A110212362'),
('A110214246'),
('A110214931'),
('A110216130'),
('A111002168'),
('A111005447'),
('A111007056'),
('A111011035'),
('A110212894'),
('A111000831'),
('A111003003'),
('A111007656'),
('A111008478'),
('A111009138'),
('A111009640'),
('A111009802'),
('A111010165'),
('A110196748'),
('A111001113'),
('A111003078'),
('A111004615'),
('A111004665'),
('A111006217'),
('A111007434'),
('A111007598'),
('A111007612'),
('A111007661'),
('A111008688'),
('A111009096'),
('A111009196'),
('A111009724'),
('A111009849'),
('A111010276'),
('A111010347'),
('A111010548'),
('A111010582'),
('A111010797'),
('B111000109'),
('A110206858'),
('A110218674'),
('A110220648'),
('A111001452'),
('A111001914'),
('A111006816'),
('A111009836'),
('A111010044'),
('A111010594'),
('A111010604'),
('A111010720'),
('A111010847'),
('A110216672'),
('A110218576'),
('A111001222'),
('A111001523'),
('A111002187'),
('A111003044'),
('A111004919'),
('A111004928'),
('A111008071'),
('A111009604'),
('A111010053'),
('A111010059'),
('A111010618'),
('A111010821'),
('A111010848'),
('A111010987'),
('A111011237'),
('A110218445'),
('A111008833'),
('A111009209'),
('A111010060'),
('A111010849'),
('A110213645'),
('A110214650'),
('A110220481'),
('A111001325'),
('A111001525'),
('A111004762'),
('A111004961'),
('A111005163'),
('A111005317'),
('A111006642'),
('A111007783'),
('A110211580'),
('A110216702'),
('A110218381'),
('A111000136'),
('A111000451'),
('A111001307'),
('A111005622'),
('A111006120'),
('A111008523'),
('A111009290'),
('A111009988'),
('A111010285'),
('A111010729'),
('A111010734'),
('B111000055'),
('B111000074'),
('A111009542'),
('A110206848'),
('A110197837'),
('A110202162'),
('A110215185'),
('A110215200'),
('A111010108'),
('A111010190'),
('A110202922'),
('A110220032'),
('A111005565'),
('A111006160'),
('A111007176'),
('A111010802'),
('A110197894'),
('A110204692'),
('A110210564'),
('A110215830'),
('A110216827'),
('A110217027'),
('A111000986'),
('A111003052'),
('A110216861'),
('A110220347'),
('A111000225'),
('A111000438'),
('A111000995'),
('A111001036'),
('A111003032'),
('A111004003'),
('A111004432'),
('A111005306'),
('A111005572'),
('A111006248'),
('A111007374'),
('A111007422'),
('A111008529'),
('A111008606'),
('A111008980'),
('A111009127'),
('A110207020'),
('A110214522'),
('A110214564'),
('A110215084'),
('A110216542'),
('A110220756'),
('A111008624'),
('A111009164'),
('A111009828'),
('A110139591'),
('A110193130'),
('A111006649'),
('A110161613'),
('A110185175'),
('A110161900'),
('A110219466'),
('A111011613'),
('A111012275'),
('A111012442'),
('A111012518'),
('A110203657'),
('A110214112')

delete NewPolicy from 
(
select p.PolicySerialNo from 
@pno p left outer join NewPolicy n
on p.PolicySerialNo = n.PolicySerialNo
where PolicyId IS NULL
) 
p where NewPolicy.PolicySerialNo = p.PolicySerialNo and NewPolicy.Kind = 'N'

insert into NewPolicy (CreateDate, Branch, Kind, PolicySerialNo, SendDate, PrintStatus, PrintDateTime, ProcessStatus)
select '1110120', '88', 'N', p.PolicySerialNo, '2022/01/20', 'N', '', 'F' from 
@pno p left outer join NewPolicy n
on p.PolicySerialNo = n.PolicySerialNo
where SerialKey IS NULL

update NewPolicy set ProcessStatus = 'F'
where PolicySerialNo in (select PolicySerialNo from @pno)

select * from NewPolicy
where PolicySerialNo in (select PolicySerialNo from @pno)
